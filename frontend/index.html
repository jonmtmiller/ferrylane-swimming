<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text y='50%' x='50%' dominant-baseline='middle' text-anchor='middle' font-size='48'>üèä</text></svg>">
  <title>Ferry Lane Swimming</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
  <header class="page-header">
    <h1 class="logo brand">
      Ferry Lane Swimming <span aria-label="Club (crossed out)" role="text"><s>Club</s></span>
      <!-- Santa hat image -->
<img id="santa-hat" class="hat" alt="" decoding="async"
     src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNDAgMTAwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9InIiIHgxPSIwIiB4Mj0iMCIgeTE9IjAiIHkyPSIxIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNlNTM5MzUiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNiNzFjMWMiLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cGF0aCBkPSJNMTIgODIgQyAxOCAzNSwgNzAgOCwgMTI4IDIwIEMgODUgMzUsIDY2IDU1LCA1MiA4MiBaIiBmaWxsPSJ1cmwoI3IpIi8+PHJlY3QgeD0iOCIgeT0iNzgiIHdpZHRoPSIxMjQiIGhlaWdodD0iMTgiIHJ4PSI5IiByeT0iOSIgZmlsbD0iI2ZmZmZmZiIvPjxjaXJjbGUgY3g9IjEyMCIgY3k9IjI2IiByPSIxMiIgZmlsbD0iI2ZmZmZmZiIvPjwvc3ZnPg==" />

    </h1>
    <p class="tagline">Current river conditions for Wargrave (unofficial)</p>
  </header>
  <main class="container">
    <section class="now-grid" id="now">
      <div class="card"><h2>River temperature</h2><div class="big" id="riverNow">‚Äì</div><div class="sub" id="riverUpdated">‚Äî</div></div>
      <div class="card"><h2>Air temperature</h2><div class="big" id="airNow">‚Äì</div><div class="sub">&nbsp;</div></div>
      <div class="card"><h2>Flow rate (Maidenhead)</h2><div class="big" id="flowNow">‚Äì</div><div class="sub" id="flowUpdated">‚Äî</div></div>
      <div class="card" id="sewageCard"><h2>Sewage status (Wargrave)</h2><div class="big" id="edmStatus">‚Äì</div><div class="sub" id="edmDetail">‚Äî</div></div>
<!--      <div class="card"><h2>Weather (next 24h)</h2><div class="big" id="wxNow">‚Äì</div><div class="sub" id="wxDetail">‚Äî</div></div> -->
      <div class="card" id="forecastCard">
  <div class="flex-between">
    <h3>Forecast (Wargrave)</h3>
    <button id="wx-toggle" class="btn btn-small" aria-expanded="false">Show forecast ‚ñæ</button>
  </div>

  <div id="wx-current" class="wx-current"></div>

  <div id="wx-collapsible">
    <div class="wx-daily" id="wx-daily" aria-label="6-day forecast"></div>

    <h4 style="margin-top:12px">Next 24 hours</h4>
    <div class="wx-hourly" id="wx-hourly" aria-label="Hourly forecast (24h)"></div>
  </div>
</div>


    </section>
    <section class="charts">
      <div class="chart-card">
  <h3 id="tempTitle">Temperatures</h3>
  <div class="range-buttons" id="tempRanges" role="group" aria-label="Temperature range">
    <button class="btn" data-days="1">24h</button>
    <button class="btn active" data-days="7">7d</button>
    <button class="btn" data-days="10">10d</button>
    <button class="btn" data-days="30">30d</button>
    <button class="btn" data-days="90">90d</button>
  </div>
  <canvas id="tempChart" height="120"></canvas>
</div>

<div class="chart-card">
  <h3 id="flowTitle">Flow rate</h3>
  <div class="range-buttons" id="flowRanges" role="group" aria-label="Flow range">
    <button class="btn" data-days="1">24h</button>
    <button class="btn active" data-days="7">7d</button>
    <button class="btn" data-days="14">14d</button>
    <button class="btn" data-days="30">30d</button>
  </div>
  <canvas id="flowChart" height="120"></canvas>
</div>

    </section>
    <section class="extras">
      <div class="map card">
        <h3>Swim stretch</h3>
        <iframe title="Wargrave Ferry Lane area map" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d9945.622407729617!2d-0.868!3d51.503!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48769b7c3a4a36d3%3A0x6f3b2a7d8c3b9e0!2sWargrave!5e0!3m2!1sen!2suk!4v1690000000000"
          width="100%" height="240" style="border:0;"></iframe>
      </div>
      <div class="card tips">
        <h3>Notes</h3>
        <ul>
          <li>This info is aggregated from other publicly available information sources; treat as indicative, not official safety advice.</li>
          <li>Temperature data from just above Shiplake Lock, via publicly available CSV files</li>
          <li>Flow data from the Environment Agency station API at Maidenhead (closest available).</li>
          <li>Sewage discharge status from Thames Water API</li>
          <li>WE ARE NOT A CLUB</li>
          <li>This is very much a work-in-progress, I'll be refining/adding things every now and then, such as weather details, discharge details etc</li>
          Jon
<br /> <br />
          <br />25DEC25 - Added Christmas mode!  Why didn't I think of that earlier in the month?!  It'll be available during December from now on.
          <br />08OCT25 - Cleaned up weather forecast, putting it behind a show/hide toggle, also fixing issue with daily vs hourly differences by aggregating rainfall.  Also caching for 15 mins rather than requesting every time, to avoiding exceeding Met Office limits.
          <br />05OCT25 - Signed up Met Office account and used that to retrieve daily forecast in tiles and hourly forecasts in scroller.  Added blatant self-promotion for upcoming gig in the header, because my site my rules.
          <br />04OCT25 - Fixed issue with charts not showing enough history; registered domain name and configured DNS/subdomain; expanded notes section.
        </ul>
      </div>
    </section>
  </main>
  <footer class="page-footer">
    <p>Uses Environment Agency flood and river level data from the Real-time Data API (Beta). Contains public sector information licensed under the Open Government Licence v3.0.</p>
    <p>CSV temperatures courtesy of the Shiplake sensor feed. No affiliation with Thames Water or the Environment Agency.</p>
  </footer>
  <script type="module" src="app.js"></script>
  <!-- Christmas Snow Layer -->
  <canvas id="snow-canvas" aria-hidden="true"></canvas>
  <!-- Christmas Toggle -->
  <button id="xmas-toggle" class="btn btn-small xmas-toggle" hidden title="Toggle Christmas mode">
    üéÑ Christmas mode
  </button>
</body>
</html>
